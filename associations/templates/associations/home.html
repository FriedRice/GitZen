<html>
<head>
<style type="text/css">
    table, td, th {
		border:1px solid black;
    }
    table.noborder, td.noborder, th.noborder {
        border:0px;
	}
	table.ref_tics {
		width:35%;
	}
	table.ref_users {
		width:60%;
		margin-left:20%;
		margin-right:20%;
	}
	table#table_tics {
		width:84%;
		margin-left:8%;
		margin-right:8%;
	}
    td {
		padding:5px;
		text-align:center;
	}

    a:link, a:visited {
        text-decoration:none;
        color:blue;
	}

	a.open, td.open {
		color:green
	}
	a.closed, td.closed {
		color:red
	}

    h1, h2, h3 {
        text-align:center;
    }
</style>
<title>Home</title>
</head>

<body>
<h1>GitZen</h1>
<h3><a href="/change/">Change Account Data</a></h3>

<h2>Associations</h2>
{% if status.o_assocs %}
    <h3>Open Associations</h3>
    {% if o_assocs %}
        <table align="center" style="width:75%">
			<tr>
				<th>Association</th>
				<th>Zendesk User</th>
				<th>Last Zen Ticket Update</th>
				<th>GitHub User</th>
				<th>Last Git Ticket Update</th>
				<th>Git Issue Labels</th>
			</tr>
        {% for a in o_assocs %}
            <tr>
				<td>
					<a class="open" href="{{ zen_url }}/tickets/
					{{ a.z_id }}">Z{{ a.z_id }}</a> --&gt; 
					<a class="open" href="{{ a.g_url }}">G{{ a.g_id }}</a>
				</td>
            <td>{{ a.z_user }}</td>
            <td class="open">{{ a.z_date }}</td>
			<td>{{ a.g_user }}</td>
			<td class="open">{{ a.g_date }}</td>
            <td>
			{% if a.g_labels %}
				{% for l in a.g_labels %}
					{% if not forloop.last %}
						{{ l }},
					{% else %}
						{{ l }}
					{% endif %}
				{% endfor %}
            {% else %}
                None
            {% endif %}
            </td>
        {% endfor %}
        </table>
    {% else %}
        <p align="center">There are currently open Associations</p>
    {% endif %}
    <br/>

    <h3>Half Open Associations</h3>
    {% if ho_assocs %}
        <table align="center" style="width:75%">
			<tr>
				<th>Association</th>
				<th>Zendesk User</th>
				<th>Last Zen Ticket Update</th>
				<th>GitHub User</th>
				<th>Last Git Ticket Update</th>
				<th>Git Issue Labels</th>
			</tr>
        {% for a in ho_assocs %}
			<tr>
				<td>
				{% if a.closed == 'g' %}
					<a class="open" href="{{ zen_url }}/tickets/
						{{ a.z_id }}">Z{{ a.z_id }}</a> --&gt; 
					<a class="closed" href="{{ a.g_url }}">G{{ a.g_id }}</a>
				{% else %}
					<a class="closed" href="{{ zen_url }}/tickets/
						{{ a.z_id }}">Z{{ a.z_id }}</a> --&gt; 
					<a class="open" href="{{ a.g_url }}">G{{ a.g_id }}</a>
				{% endif %}
				</td>
				<td>{{ a.z_user }}</td>
				{% if a.closed == 'z' %}
					<td class="closed">{{ a.z_date }}</td>
				{% else %}
					<td class="open">{{ a.z_date }}</td>
				{% endif %}
				<td>{{ a.g_user }}</td>
				{% if a.closed == 'g' %}
					<td class="closed">{{ a.g_date }}</td>
				{% else %}
					<td class="open">{{ a.g_date }}</td>
				{% endif %}
				<td>
				{% if a.g_labels %}
					{% for l in a.g_labels %}
						{% if not forloop.last %}
							{{ l }},
						{% else %}
							{{ l }}
						{% endif %}
					{% endfor %}
				{% else %}
					None
				{% endif %}
				</td>
            </tr>
        {% endfor %}
        </table>
    {% else %}
        <p align="center">There are currently no half-open Associations.</p>
    {% endif %}
    <br/>

    <h3>New Tickets not Associated with GitHub</h3>
    {% if no_assocs %}
        <table align="center" style="width:50%">
			<tr>
				<th>Zendesk Ticket</th>
				<th>Zendesk User</th>
				<th>Last Updated</th>
				<th>Displayed Association</th>
			</tr>
        {% for a in no_assocs %}
            <tr>
            	<td><a class="open" href="{{ zen_url }}/tickets/
						{{ a.z_id }}">Z{{ a.z_id }}</a>
				</td>
				<td>{{ a.z_user }}</td>
				<td class="open">{{ a.z_date }}</td>
				<td>{{ a.assoc }}</td>
            </tr>
        {% endfor %}
        </table>
    {% else %}
        <p align="center">There are currently no Zendesk Tickets without GitHub 
							Associations.</p>
    {% endif %}
{% else %}
    <p align="center">There was an Error connecting to either GitHub or
    Zendesk. Try adjusting your account settings.</p>
{% endif %}

<br/>
<p align="center">{{ times.api }}</p>
<p align="center">{{ times.filter }}</p>
<p align="center">{{ times.build }}</p>

<!--

TODO: Update the Quick Reference tables within this comment so that they work
with the changes made in the code.

<br/><br/>

<h2>Quick Reference</h2>
<br/>

<table id="table_tics" class="noborder">
<col width="90%" />
<tr>
<td class="noborder">
    <table>
    <tr>
    	<th colspan="2">Open GitHub Tickets</th>
	</tr>
	<tr>
		<th>Issue #</th>
		<th>Subject</th>
	</tr>

    {% if status.git %}
        {% if git_tics %}
            {% for i in git_tics %}
			<tr>
				<td>
					<a href='https://github.com/{{ repo }}
						/issues/{{ i.number }}'>{{ i.number }}</a>
				</td>
				<td>
					{{ i.title }}
				</td>
			</tr>
            {% endfor %}
        {% else %}
		<tr><td align="center">There are currently no open 
				GitHub Tickets.</td></tr>
		<tr><td align="center">There was an Error connecting to GitHub. Try 
        {% endif %}
    {% else %}
		<tr><td align="center">There was an Error connecting to GitHub. Try 
		adjusting your account settings.</td></tr>
    {% endif %}
    </table>
</td>

<td class="noborder">
    <table>
    <tr>
    <th colspan="2">Zendesk Tickets</th>
    </tr>
    <tr>
    <th>Subject</th>
    <th>Requester</th>
    </tr>

    {% if working.zen %}
        {% if zen_tics %}
            {% for t in zen_tics %}
                <tr>
                <td><a href="{{ zen_url }}/tickets/{{ t.id }}?col={{ zen_viewid }}">{{ t.id }}.</a> 
                {{ t.subject }}</td>
                <td>{{ t.req_name }}</td>
                </tr>
            {% endfor %}
        {% else %}
			<tr><td align="center" colspan="2">There are currently no Zendesk
			Tickets.</td></tr>
        {% endif %}
    {% else %}
		<tr><td align="center" colspan="2">There was an Error connecting 
		to Zendesk. Try adjusting your account settings.</td></tr>
    {% endif %}
    </table>
</td>
</tr>
</table>

<br/>

<table class="ref_users">
    <tr>
    	<th colspan="3">Zendesk Users</th>
    </tr>
    <tr>
		<th>Name</th>
		<th>Email</th>
		<th>Organization</th>
    </tr>

    {% if working.zen %}
        {% if zen_users %}
            {% for u in zen_users %}
                <tr>
                <td align="center"><a href="{{ zen_url }}/users/{{ u.id }}"
                >{{ u.name }}</a></td>
                <td>{{ u.email }}</td>
                <td>{{ u.org_name }}</td>
                </tr>
            {% endfor %}
        {% else %}
			<tr><td align="center" colspan="3">There are currently no Zendesk 
			users.</td></tr>
        {% endif %}
    {% else %}
		<tr><td align="center" colspan="3">There was an Error connecting 
		to Zendesk. Try adjusting your account settings.</td></tr>
    {% endif %}
</table>
-->
</body>
</html>
